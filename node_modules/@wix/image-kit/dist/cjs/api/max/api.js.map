{"version":3,"names":["_imageServiceConstants","require","_imageServiceUtils","_attributes","_transform","_uri","_srcset","_imagePlaceholderUtils","PLACEHOLDER_IMG_CSS_OVERRIDES","width","height","getPlaceholder","fittingType","src","target","options","autoEncode","isSEOBot","shouldLoadHQImage","hasAnimation","allowAnimatedTransform","encoding","isValidRequest","emptyData","IS_IN_PLACEHOLDER_FLOW","shouldAllowAnimatedTransformInPlaceholder","canTransformImage","isImageTransformApplicable","id","getData","useSrcset","newTarget","validateTargetDimensions","alignment","htmlTag","isFakeTile","getIsFakeTile","scaledDimensions","getScaledDimensions","blur","getBlurValue","convertedFittingType","getConvertedFitting","overrideCSS","getCSSOverrides","uri","filters","isPlaceholderFlow","attr","css","img","container","Object","assign","transformed","data","targetObj","getTarget","transformObj","getTransform","getURI","srcset","getSrcset","getAttributes"],"sources":["../../../../src/api/max/api.ts"],"sourcesContent":["import { emptyData } from '../../helpers/imageServiceConstants';\nimport {\n  isImageTransformApplicable,\n  isValidRequest,\n} from '../../helpers/imageServiceUtils';\nimport { getAttributes } from '../../engines/attributes';\nimport { getTransform, getTarget } from '../transform';\nimport { getURI } from '../uri';\nimport { getSrcset } from '../srcset';\nimport type {\n  ImageDataAttributes,\n  FittingType,\n  ImageTransformSource,\n  ImageTransformTarget,\n  ImagePlaceholderTransformTarget,\n  ImageTransformOptions,\n} from '../../types';\nimport {\n  getScaledDimensions,\n  getBlurValue,\n  getCSSOverrides,\n  validateTargetDimensions,\n  getIsFakeTile,\n  getConvertedFitting,\n} from '../../helpers/imagePlaceholderUtils';\n\nconst PLACEHOLDER_IMG_CSS_OVERRIDES = { width: '100%', height: '100%' };\n\n/**\n * returns image _placeholder_ transform uri and the\n * needed css for alignment and positioning\n *\n * @param {FittingType}             fittingType imageServicesTypes.fittingTypes\n * @param {ImageTransformSource}    src         image\n * @param {ImagePlaceholderTransformTarget}    target      target dimensions\n * @param {ImageTransformOptions} [options]   environment / transformation  options\n *\n * @returns {ImageDataAttributes}\n */\nfunction getPlaceholder(\n  fittingType: FittingType,\n  src: ImageTransformSource,\n  target: ImagePlaceholderTransformTarget,\n  options: ImageTransformOptions = {},\n): ImageDataAttributes {\n  const {\n    autoEncode = true,\n    isSEOBot,\n    shouldLoadHQImage,\n    hasAnimation,\n    allowAnimatedTransform,\n    encoding,\n  } = options;\n\n  if (!isValidRequest(fittingType, src, target as ImageTransformTarget)) {\n    return emptyData;\n  }\n\n  const IS_IN_PLACEHOLDER_FLOW = true;\n\n  // In placeholder flow, allow animated transforms by default unless explicitly disabled\n  const shouldAllowAnimatedTransformInPlaceholder =\n    allowAnimatedTransform ?? IS_IN_PLACEHOLDER_FLOW;\n\n  const canTransformImage = isImageTransformApplicable(\n    src.id,\n    hasAnimation,\n    shouldAllowAnimatedTransformInPlaceholder,\n  );\n\n  if (!canTransformImage || shouldLoadHQImage) {\n    /* Either:\n     * 1. Transform isn't applicable so target is original size applied with fluid CSS\n     * 2. User asked for an HQ image, so they must have supplied target size (width/height)\n     */\n    return getData(fittingType, src, target as ImageTransformTarget, {\n      ...options,\n      autoEncode,\n      useSrcset: canTransformImage,\n    });\n  }\n\n  // If there aren't dimensions, we make them up\n  const newTarget = {\n    ...target,\n    ...validateTargetDimensions(src, target),\n  } as ImageTransformTarget;\n\n  const { alignment, htmlTag } = newTarget;\n  const isFakeTile = getIsFakeTile(fittingType, src, newTarget);\n\n  const scaledDimensions = getScaledDimensions(\n    fittingType,\n    src,\n    newTarget,\n    isSEOBot,\n  );\n\n  const blur = getBlurValue(newTarget.width, fittingType, isSEOBot);\n\n  const convertedFittingType = getConvertedFitting(fittingType, isFakeTile);\n\n  const overrideCSS = getCSSOverrides(\n    fittingType,\n    src,\n    target,\n    alignment as string,\n  );\n\n  const { uri } = getData(\n    convertedFittingType as FittingType,\n    src,\n    {\n      ...scaledDimensions,\n      alignment,\n      htmlTag,\n    },\n    {\n      autoEncode,\n      filters: blur ? { blur } : {},\n      hasAnimation,\n      allowAnimatedTransform: shouldAllowAnimatedTransformInPlaceholder,\n      encoding,\n      isPlaceholderFlow: IS_IN_PLACEHOLDER_FLOW,\n    },\n  );\n\n  const { attr = {}, css } = getData(\n    fittingType,\n    src,\n    {\n      ...newTarget,\n      alignment,\n      htmlTag,\n    },\n    {},\n  );\n\n  css!.img = css!.img || {};\n  css!.container = css!.container || {};\n  Object.assign(css!.img, overrideCSS.img, PLACEHOLDER_IMG_CSS_OVERRIDES);\n  Object.assign(css!.container, overrideCSS.container);\n\n  return { uri, css, attr, transformed: true };\n}\n\n/**\n * returns image transform uri and the\n * needed css for alignment and positioning\n *\n * @param {FittingType}             fittingType         imageServicesTypes.fittingTypes\n * @param {ImageTransformSource}    src                 source image\n * @param {ImageTransformTarget}    target              target component\n * @param {ImageTransformOptions}   [options]          transform options\n *\n * @returns {ImageDataAttributes}\n */\nfunction getData(\n  fittingType: FittingType,\n  src: ImageTransformSource,\n  target: ImageTransformTarget,\n  options?: ImageTransformOptions,\n) {\n  let data: ImageDataAttributes = {} as ImageDataAttributes;\n\n  // check if valid request\n  if (isValidRequest(fittingType, src, target)) {\n    // handle site BG legacy fitting types if needed\n    const targetObj = getTarget(fittingType, src, target);\n    // parse request and create working OBJ\n    const transformObj = getTransform(fittingType, src, targetObj, options);\n\n    data.uri = getURI(fittingType, src, targetObj, options, transformObj);\n\n    if (options?.useSrcset) {\n      data.srcset = getSrcset(fittingType, src, targetObj, options, data);\n    }\n\n    // set the CSS or the SVG property\n    Object.assign(data, getAttributes(transformObj, targetObj), {\n      transformed: transformObj.transformed,\n    });\n  } else {\n    // empty data\n    data = emptyData;\n  }\n\n  // return data to be used in html\n  return data;\n}\n\nexport { getData, getPlaceholder };\n"],"mappings":"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","ignoreList":[]}