{"version":3,"names":["_max","require","alignTypes","CENTER","TOP","TOP_LEFT","TOP_RIGHT","BOTTOM","BOTTOM_LEFT","BOTTOM_RIGHT","LEFT","RIGHT","getCropDataWithAlign","targetAspectRatio","originalAspectRatio","originalHeight","originalWidth","targetHeight","lowerWidth","bpWidth","alignType","width","height","Math","round","y","x","includes","WIDTHS","getSources","widthProportion","targetWidth","uri","quality","name","hasAnimation","upscaleMethod","focalPoint","crop","encoding","siteMargin","displayMode","allowFullGIFTransformation","hasOriginalSizeDisplayMode","map","index","isLowestBreakpoint","getWidth","w","lowerBpWidth","currentBpWidth","useManualCrop","manualCrop","srcset","fallbackSrc","css","getResponsiveImageProps","img","objectFit","sizes","media","imgStyle","imageProps","allowAnimatedTransform","_srcset$dpr","src","getData","id","alignment","useSrcset","srcsetWithPrefix","dpr","s","test","STATIC_MEDIA_URL","srcsetString","join","sources","filter","Boolean","reverse","exports"],"sources":["../../../src/helpers/responsiveImageUtils.ts"],"sourcesContent":["import { getData, STATIC_MEDIA_URL } from '../api/max';\nimport type { AlignType, Encoding, Sources, UpscaleMethod } from '../types';\n\nconst alignTypes = {\n  CENTER: 'center',\n  TOP: 'top',\n  TOP_LEFT: 'top_left',\n  TOP_RIGHT: 'top_right',\n  BOTTOM: 'bottom',\n  BOTTOM_LEFT: 'bottom_left',\n  BOTTOM_RIGHT: 'bottom_right',\n  LEFT: 'left',\n  RIGHT: 'right',\n} as const;\n\ntype AlignTypeKey = keyof typeof alignTypes;\ntype AlignTypeValue = (typeof alignTypes)[AlignTypeKey];\n\nconst getCropDataWithAlign = (\n  targetAspectRatio: number,\n  originalAspectRatio: number,\n  originalHeight: number,\n  originalWidth: number,\n  targetHeight: number,\n  lowerWidth: number,\n  bpWidth: number,\n  alignType: AlignTypeValue = alignTypes.CENTER,\n) => {\n  if (targetAspectRatio > originalAspectRatio) {\n    // Image needs vertical cropping\n    const width = originalWidth;\n    const height = Math.round(originalWidth / (lowerWidth / targetHeight));\n    let y = Math.round(originalHeight / 2 - height / 2);\n    const x = 0;\n\n    if (alignType.includes('top')) {\n      y = 0;\n    } else if (alignType.includes('bottom')) {\n      y = originalHeight - height;\n    }\n\n    return { width, height, x, y };\n  } else {\n    // Image needs horizontal cropping\n    const width = Math.round(originalHeight / (targetHeight / bpWidth));\n    const height = originalHeight;\n\n    let x = Math.round(originalWidth / 2 - width / 2);\n    const y = 0;\n\n    if (alignType.includes('left')) {\n      x = 0;\n    } else if (alignType.includes('right')) {\n      x = originalWidth - width;\n    }\n\n    return { width, height, x, y };\n  }\n};\n\nconst WIDTHS = [1920, 1536, 1366, 1280, 980];\n\nconst getSources = (\n  widthProportion: number,\n  originalWidth: number,\n  originalHeight: number,\n  targetHeight: number,\n  targetWidth: number,\n  uri: string,\n  quality: any,\n  name?: string,\n  alignType?: AlignType,\n  hasAnimation?: boolean,\n  upscaleMethod?: UpscaleMethod,\n  focalPoint?: any,\n  crop?: any,\n  encoding?: Encoding,\n  siteMargin?: number,\n  displayMode?: string,\n  allowFullGIFTransformation?: boolean,\n): Sources[] => {\n  const hasOriginalSizeDisplayMode = displayMode === 'original_size';\n  const originalAspectRatio = originalWidth / originalHeight;\n\n  return WIDTHS.map((width, index) => {\n    const isLowestBreakpoint = width === 980;\n\n    const getWidth = (w: number) => {\n      if (isLowestBreakpoint) {\n        return targetWidth;\n      }\n      return (w - 2 * (siteMargin || 0)) * (widthProportion / 100);\n    };\n\n    const lowerBpWidth = getWidth(WIDTHS[index + 1]);\n    const currentBpWidth = getWidth(width);\n\n    const targetAspectRatio = lowerBpWidth / targetHeight;\n    const useManualCrop = !(hasOriginalSizeDisplayMode || isLowestBreakpoint);\n\n    const manualCrop =\n      useManualCrop &&\n      getCropDataWithAlign(\n        targetAspectRatio,\n        originalAspectRatio,\n        originalHeight,\n        originalWidth,\n        targetHeight,\n        lowerBpWidth,\n        currentBpWidth,\n        alignType,\n      );\n\n    const { srcset, fallbackSrc, css } = getResponsiveImageProps(\n      {\n        displayMode: hasOriginalSizeDisplayMode\n          ? 'original_size'\n          : isLowestBreakpoint\n          ? 'fill'\n          : 'fit',\n        uri,\n        width: originalWidth,\n        height: originalHeight,\n        crop: crop || manualCrop,\n        name,\n        focalPoint,\n        alignType,\n        quality,\n        upscaleMethod,\n        hasAnimation,\n        encoding,\n        allowFullGIFTransformation,\n      },\n      currentBpWidth,\n      targetHeight,\n    );\n\n    if (hasOriginalSizeDisplayMode && css) {\n      css.img.objectFit = 'cover';\n    }\n\n    return {\n      srcset: srcset || '',\n      sizes: isLowestBreakpoint\n        ? `${widthProportion}vw`\n        : `${currentBpWidth}px`,\n      media: `(max-width: ${width}px)`,\n      fallbackSrc,\n      imgStyle: css?.img,\n    };\n  });\n};\n\nexport const getResponsiveImageProps = (\n  imageProps: Record<string, any>,\n  targetWidth: number,\n  targetHeight: number,\n) => {\n  const {\n    displayMode,\n    uri,\n    width,\n    height,\n    name,\n    crop,\n    focalPoint,\n    alignType,\n    quality,\n    upscaleMethod,\n    hasAnimation,\n    allowAnimatedTransform,\n    encoding,\n    siteMargin,\n    widthProportion,\n    allowFullGIFTransformation,\n  } = imageProps;\n\n  if (!widthProportion) {\n    const {\n      srcset,\n      css,\n      uri: src,\n    } = getData(\n      displayMode,\n      { id: uri as string, width, height, name, crop, focalPoint },\n      {\n        width: targetWidth as number,\n        height: targetHeight as number,\n        alignment: alignType,\n      },\n      {\n        focalPoint,\n        name,\n        quality: quality?.quality,\n        upscaleMethod,\n        hasAnimation,\n        allowAnimatedTransform,\n        useSrcset: true,\n        encoding,\n        allowFullGIFTransformation,\n      },\n    );\n\n    const srcsetWithPrefix = srcset?.dpr?.map((s: string) =>\n      /^[a-z]+:/.test(s) ? s : `${STATIC_MEDIA_URL}${s}`,\n    );\n\n    const fallbackSrc = `${STATIC_MEDIA_URL}${src}`;\n    const srcsetString = srcsetWithPrefix?.join(', ') || '';\n\n    return {\n      fallbackSrc,\n      srcset: srcsetString,\n      css,\n    };\n  } else {\n    const sources = getSources(\n      widthProportion,\n      width,\n      height,\n      targetHeight,\n      targetWidth,\n      uri,\n      quality,\n      name,\n      alignType,\n      hasAnimation,\n      upscaleMethod,\n      focalPoint,\n      crop,\n      encoding,\n      siteMargin,\n      displayMode,\n      allowFullGIFTransformation,\n    )\n      .filter(Boolean)\n      .reverse();\n\n    return {\n      fallbackSrc: sources[0].fallbackSrc,\n      sources,\n      css: sources[0].imgStyle,\n    };\n  }\n};\n"],"mappings":"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","ignoreList":[]}