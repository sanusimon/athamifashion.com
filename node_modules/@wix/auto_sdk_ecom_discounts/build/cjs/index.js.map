{"version":3,"sources":["../../index.ts","../../src/service-plugins-types.ts","../../src/interfaces-ecommerce-v1-discounts-provider.public.ts","../../src/interfaces-ecommerce-v1-discounts-provider.context.ts","../../src/service-plugins-error-classes.ts"],"sourcesContent":["export * from './src/service-plugins-types.js';\nexport * from './src/interfaces-ecommerce-v1-discounts-provider.context.js';\nexport * from './src/service-plugins-error-classes.js';\n","export interface GetEligibleDiscountsRequest {\n  /**\n   * Line items\n   * @maxSize 300\n   */\n  lineItems?: LineItem[];\n  /**\n   * Persistent ID that correlates between the various eCommerce elements: cart, checkout, and order.\n   * @format GUID\n   */\n  purchaseFlowId?: string | null;\n  /**\n   * Number of coupons is limited to 1 due to limitations in Checkout.\n   * @maxSize 1\n   * @maxLength 20\n   */\n  couponCodes?: string[];\n  /**\n   * Buyer email\n   * @format EMAIL\n   */\n  buyerEmail?: string | null;\n}\n\nexport interface LineItem {\n  /**\n   * Line item ID.\n   * @format GUID\n   */\n  _id?: string;\n  /**\n   * Line item quantity.\n   * @max 100000\n   */\n  quantity?: number | null;\n  /** Catalog and item reference info. Learn more about [integrating Wix Stores products with Wix eCommerce](https://dev.wix.com/api/rest/wix-stores/catalog/ecommerce-integration). */\n  catalogReference?: CatalogReference;\n  /**\n   * Line item price.\n   * @format DECIMAL_VALUE\n   * @decimalValue options { gte:0, maxScale:6 }\n   */\n  price?: string;\n}\n\n/** Used for grouping line items. Sent when an item is added to a cart, checkout, or order. */\nexport interface CatalogReference {\n  /**\n   * ID of the item within the catalog it belongs to.\n   * @minLength 1\n   * @maxLength 36\n   */\n  catalogItemId?: string;\n  /**\n   * ID of the app providing the catalog.\n   *\n   * You can get your app's ID from its page in the [app dashboard](https://dev.wix.com/dc3/my-apps/).\n   *\n   * For items from Wix catalogs, the following values always apply:\n   * + Wix Stores: `\"215238eb-22a5-4c36-9e7b-e7c08025e04e\"`\n   * + Wix Bookings: `\"13d21c63-b5ec-5912-8397-c3a5ddb27a97\"`\n   * + Wix Restaurants: `\"9a5d83fd-8570-482e-81ab-cfa88942ee60\"`\n   * @minLength 1\n   */\n  appId?: string;\n  /**\n   * Additional item details in key:value pairs. Use this optional field to provide more specificity with item selection. The `options` field values differ depending on which catalog is providing the items.\n   *\n   * For products and variants from a Wix Stores catalog, learn more about [eCommerce integration](https://dev.wix.com/docs/rest/business-solutions/stores/catalog/e-commerce-integration).\n   */\n  options?: Record<string, any> | null;\n}\n\nexport interface GetEligibleDiscountsResponse {\n  /**\n   * List of discounts to apply\n   * @maxSize 100\n   */\n  discounts?: Discount[];\n}\n\n/** Discount */\nexport interface Discount\n  extends DiscountDiscountTypeOneOf,\n    DiscountDiscountScopesOneOf {\n  /** Global discounts */\n  globalDiscounts?: BaseDiscounts;\n  /** Shipping discounts */\n  shippingDiscounts?: BaseDiscounts;\n  /** line items discounts */\n  lineItemsDiscounts?: LineItemsDiscounts;\n  /** Coupon options */\n  couponOptions?: CouponOptions;\n  /** Target type */\n  targetType?: TargetType;\n  /** Name */\n  name?: DiscountName;\n  /**\n   * external id used by the implementor\n   * @maxLength 50\n   */\n  externalId?: string | null;\n  /** Source */\n  source?: DiscountSource;\n}\n\n/** @oneof */\nexport interface DiscountDiscountTypeOneOf {\n  /** Global discounts */\n  globalDiscounts?: BaseDiscounts;\n  /** Shipping discounts */\n  shippingDiscounts?: BaseDiscounts;\n  /** line items discounts */\n  lineItemsDiscounts?: LineItemsDiscounts;\n}\n\n/** @oneof */\nexport interface DiscountDiscountScopesOneOf {\n  /** Coupon options */\n  couponOptions?: CouponOptions;\n}\n\nexport enum TargetType {\n  UNKNOWN_TARGET = 'UNKNOWN_TARGET',\n  GLOBAL = 'GLOBAL',\n  SHIPPING = 'SHIPPING',\n  LINE_ITEMS = 'LINE_ITEMS',\n}\n\nexport interface DiscountName {\n  /**\n   * Original discount rule name (in site's default language).\n   * @minLength 1\n   * @maxLength 256\n   */\n  original?: string;\n  /**\n   * Translated discount rule name according to buyer language.\n   *\n   * Default: `original`\n   * @minLength 1\n   * @maxLength 500\n   */\n  translated?: string | null;\n}\n\nexport interface BaseDiscounts {\n  /** The rate of the discount. */\n  rate?: DiscountRate;\n}\n\nexport interface DiscountRate extends DiscountRateRateOneOf {\n  /**\n   * Global discounts\n   * @decimalValue options { gte:0, maxScale:6 }\n   */\n  fixedAmountValue?: string;\n  /**\n   * Shipping discounts\n   * @decimalValue options { gte:0, maxScale:6 }\n   */\n  percentageValue?: string;\n  /** Type of calculation */\n  type?: Type;\n}\n\n/** @oneof */\nexport interface DiscountRateRateOneOf {\n  /**\n   * Global discounts\n   * @decimalValue options { gte:0, maxScale:6 }\n   */\n  fixedAmountValue?: string;\n  /**\n   * Shipping discounts\n   * @decimalValue options { gte:0, maxScale:6 }\n   */\n  percentageValue?: string;\n}\n\nexport enum Type {\n  UNKNOWN_RATE = 'UNKNOWN_RATE',\n  FIXED_AMOUNT = 'FIXED_AMOUNT',\n  PERCENTAGE = 'PERCENTAGE',\n}\n\nexport interface LineItemsDiscounts {\n  /**\n   * Line items\n   * @maxSize 300\n   */\n  lineItems?: LineItemRate[];\n}\n\nexport interface LineItemRate {\n  /** The rate of the discount. */\n  rate?: DiscountRate;\n  /**\n   * id of the line item.\n   * @format GUID\n   */\n  _id?: string;\n}\n\nexport enum DiscountSource {\n  UNKNOWN_SOURCE = 'UNKNOWN_SOURCE',\n  COUPON = 'COUPON',\n  AUTOMATIC = 'AUTOMATIC',\n  CUSTOM = 'CUSTOM',\n}\n\nexport interface CouponOptions {\n  /**\n   * Coupon code, only relevant when source is coupon.\n   * @maxLength 20\n   */\n  code?: string | null;\n}\n\nexport interface DiscountsSPIConfig {\n  /**\n   * Base URI where the endpoints are called.\n   * Wix eCommerce appends the endpoint path to the base URI.\n   * @minLength 1\n   * @maxLength 200\n   */\n  deploymentUri?: string;\n}\n\n/**\n * this message is not directly used by any service,\n * it exists to describe the expected parameters that SHOULD be provided to invoked Velo methods as part of open-platform.\n * e.g. SPIs, event-handlers, etc..\n * NOTE: this context object MUST be provided as the last argument in each Velo method signature.\n *\n * Example:\n * ```typescript\n * export function wixStores_onOrderCanceled({ event, metadata }: OrderCanceledEvent) {\n * ...\n * }\n * ```\n */\nexport interface Context {\n  /** A unique identifier of the request. You may print this ID to your logs to help with future debugging and easier correlation with Wix's logs. */\n  requestId?: string | null;\n  /**\n   * [ISO 4217](https://en.wikipedia.org/wiki/ISO_4217) 3-letter currency code.\n   * @format CURRENCY\n   */\n  currency?: string | null;\n  /** An object that describes the identity that triggered this request. */\n  identity?: IdentificationData;\n  /** A string representing a language and region in the format of `\"xx-XX\"`. First 2 letters represent the language code according to ISO 639-1. This is followed by a dash \"-\", and then a by 2 capital letters representing the region according to ISO 3166-2. For example, `\"en-US\"`. */\n  languages?: string[];\n  /**\n   * The service provider app's instance ID.\n   * @format GUID\n   */\n  instanceId?: string | null;\n}\n\nexport enum IdentityType {\n  UNKNOWN = 'UNKNOWN',\n  ANONYMOUS_VISITOR = 'ANONYMOUS_VISITOR',\n  MEMBER = 'MEMBER',\n  WIX_USER = 'WIX_USER',\n  APP = 'APP',\n}\n\nexport interface IdentificationData extends IdentificationDataIdOneOf {\n  /**\n   * ID of a site visitor that has not logged in to the site.\n   * @format GUID\n   */\n  anonymousVisitorId?: string;\n  /**\n   * ID of a site visitor that has logged in to the site.\n   * @format GUID\n   */\n  memberId?: string;\n  /**\n   * ID of a Wix user (site owner, contributor, etc.).\n   * @format GUID\n   */\n  wixUserId?: string;\n  /**\n   * ID of an app.\n   * @format GUID\n   */\n  appId?: string;\n  /** @readonly */\n  identityType?: IdentityType;\n}\n\n/** @oneof */\nexport interface IdentificationDataIdOneOf {\n  /**\n   * ID of a site visitor that has not logged in to the site.\n   * @format GUID\n   */\n  anonymousVisitorId?: string;\n  /**\n   * ID of a site visitor that has logged in to the site.\n   * @format GUID\n   */\n  memberId?: string;\n  /**\n   * ID of a Wix user (site owner, contributor, etc.).\n   * @format GUID\n   */\n  wixUserId?: string;\n  /**\n   * ID of an app.\n   * @format GUID\n   */\n  appId?: string;\n}\n","import { ServicePluginDefinition } from '@wix/sdk-types';\nimport {\n  Context,\n  GetEligibleDiscountsRequest,\n  GetEligibleDiscountsResponse,\n} from './service-plugins-types.js';\nimport {\n  renameKeysFromSDKRequestToRESTRequest,\n  renameKeysFromRESTResponseToSDKResponse,\n} from '@wix/sdk-runtime/rename-all-nested-keys';\n\nexport interface GetEligibleDiscountsEnvelope {\n  request: GetEligibleDiscountsRequest;\n  metadata: Context;\n}\n\nexport const provideHandlers = ServicePluginDefinition<{\n  /**\n   *\n   * Wix calls this method when certain actions are performed on the cart or checkout.\n   * For example, when an item is added to the cart or the amount of an item is updated in the checkout. */\n  getEligibleDiscounts(\n    payload: GetEligibleDiscountsEnvelope\n  ): GetEligibleDiscountsResponse | Promise<GetEligibleDiscountsResponse>;\n}>('ECOM_DISCOUNTS', [\n  {\n    name: 'getEligibleDiscounts',\n    primaryHttpMappingPath: '/v1/eligible-discounts',\n    transformations: {\n      toREST: (payload: any) => {\n        const toRestResponse = payload;\n\n        return renameKeysFromSDKRequestToRESTRequest(toRestResponse);\n      },\n      fromREST: (payload: any) => {\n        const fromRestRequest = payload;\n\n        return renameKeysFromRESTResponseToSDKResponse(fromRestRequest);\n      },\n    },\n  },\n]);\n","import './interfaces-ecommerce-v1-discounts-provider.public.js';\nimport { createServicePluginModule } from '@wix/sdk-runtime/service-plugin-modules';\nimport { BuildServicePluginDefinition } from '@wix/sdk-types';\nimport { provideHandlers as publicProvideHandlers } from './interfaces-ecommerce-v1-discounts-provider.public.js';\n\nexport { publicProvideHandlers };\n\nexport const provideHandlers: BuildServicePluginDefinition<\n  typeof publicProvideHandlers\n> &\n  typeof publicProvideHandlers = createServicePluginModule(\n  publicProvideHandlers\n);\n","export class CouponLimitPerCustomerExceededWixError extends Error {\n  /** @hidden */\n  httpCode: number;\n  /** @hidden */\n  statusCode: string;\n  /** @hidden */\n  applicationCode: string;\n  /** @hidden */\n  name: string;\n  /** @hidden */\n  errorType: string;\n  /** @hidden */\n  spiErrorData: object;\n\n  constructor() {\n    super('CouponLimitPerCustomerExceeded');\n\n    this.httpCode = 428;\n    this.statusCode = 'FAILED_PRECONDITION';\n    this.applicationCode = 'ERROR_COUPON_LIMIT_PER_CUSTOMER_EXCEEDED';\n    this.name = 'CouponLimitPerCustomerExceeded';\n    this.errorType = 'SPI';\n    this.spiErrorData = {\n      name: 'CouponLimitPerCustomerExceeded',\n      applicationCode: 'ERROR_COUPON_LIMIT_PER_CUSTOMER_EXCEEDED',\n    };\n  }\n\n  /** @hidden */\n  static readonly __type = 'wix_spi_error';\n}\n\nexport class CouponIsDisabledWixError extends Error {\n  /** @hidden */\n  httpCode: number;\n  /** @hidden */\n  statusCode: string;\n  /** @hidden */\n  applicationCode: string;\n  /** @hidden */\n  name: string;\n  /** @hidden */\n  errorType: string;\n  /** @hidden */\n  spiErrorData: object;\n\n  constructor() {\n    super('CouponIsDisabled');\n\n    this.httpCode = 428;\n    this.statusCode = 'FAILED_PRECONDITION';\n    this.applicationCode = 'ERROR_COUPON_IS_DISABLED';\n    this.name = 'CouponIsDisabled';\n    this.errorType = 'SPI';\n    this.spiErrorData = {\n      name: 'CouponIsDisabled',\n      applicationCode: 'ERROR_COUPON_IS_DISABLED',\n    };\n  }\n\n  /** @hidden */\n  static readonly __type = 'wix_spi_error';\n}\n\nexport class CouponUsageExceededWixError extends Error {\n  /** @hidden */\n  httpCode: number;\n  /** @hidden */\n  statusCode: string;\n  /** @hidden */\n  applicationCode: string;\n  /** @hidden */\n  name: string;\n  /** @hidden */\n  errorType: string;\n  /** @hidden */\n  spiErrorData: object;\n\n  constructor() {\n    super('CouponUsageExceeded');\n\n    this.httpCode = 428;\n    this.statusCode = 'FAILED_PRECONDITION';\n    this.applicationCode = 'ERROR_COUPON_USAGE_EXCEEDED';\n    this.name = 'CouponUsageExceeded';\n    this.errorType = 'SPI';\n    this.spiErrorData = {\n      name: 'CouponUsageExceeded',\n      applicationCode: 'ERROR_COUPON_USAGE_EXCEEDED',\n    };\n  }\n\n  /** @hidden */\n  static readonly __type = 'wix_spi_error';\n}\n\nexport class CouponHasExpiredWixError extends Error {\n  /** @hidden */\n  httpCode: number;\n  /** @hidden */\n  statusCode: string;\n  /** @hidden */\n  applicationCode: string;\n  /** @hidden */\n  name: string;\n  /** @hidden */\n  errorType: string;\n  /** @hidden */\n  spiErrorData: object;\n\n  constructor() {\n    super('CouponHasExpired');\n\n    this.httpCode = 428;\n    this.statusCode = 'FAILED_PRECONDITION';\n    this.applicationCode = 'ERROR_COUPON_HAS_EXPIRED';\n    this.name = 'CouponHasExpired';\n    this.errorType = 'SPI';\n    this.spiErrorData = {\n      name: 'CouponHasExpired',\n      applicationCode: 'ERROR_COUPON_HAS_EXPIRED',\n    };\n  }\n\n  /** @hidden */\n  static readonly __type = 'wix_spi_error';\n}\n\nexport class CouponIsNotActiveYetWixError extends Error {\n  /** @hidden */\n  httpCode: number;\n  /** @hidden */\n  statusCode: string;\n  /** @hidden */\n  applicationCode: string;\n  /** @hidden */\n  name: string;\n  /** @hidden */\n  errorType: string;\n  /** @hidden */\n  spiErrorData: object;\n\n  constructor() {\n    super('CouponIsNotActiveYet');\n\n    this.httpCode = 428;\n    this.statusCode = 'FAILED_PRECONDITION';\n    this.applicationCode = 'ERROR_COUPON_IS_NOT_ACTIVE_YET';\n    this.name = 'CouponIsNotActiveYet';\n    this.errorType = 'SPI';\n    this.spiErrorData = {\n      name: 'CouponIsNotActiveYet',\n      applicationCode: 'ERROR_COUPON_IS_NOT_ACTIVE_YET',\n    };\n  }\n\n  /** @hidden */\n  static readonly __type = 'wix_spi_error';\n}\n\nexport class CouponDoesNotExistWixError extends Error {\n  /** @hidden */\n  httpCode: number;\n  /** @hidden */\n  statusCode: string;\n  /** @hidden */\n  applicationCode: string;\n  /** @hidden */\n  name: string;\n  /** @hidden */\n  errorType: string;\n  /** @hidden */\n  spiErrorData: object;\n\n  constructor() {\n    super('CouponDoesNotExist');\n\n    this.httpCode = 404;\n    this.statusCode = 'NOT_FOUND';\n    this.applicationCode = 'ERROR_COUPON_DOES_NOT_EXIST';\n    this.name = 'CouponDoesNotExist';\n    this.errorType = 'SPI';\n    this.spiErrorData = {\n      name: 'CouponDoesNotExist',\n      applicationCode: 'ERROR_COUPON_DOES_NOT_EXIST',\n    };\n  }\n\n  /** @hidden */\n  static readonly __type = 'wix_spi_error';\n}\n"],"mappings":"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","names":["provideHandlers","TargetType","Type","DiscountSource","IdentityType","provideHandlers"]}